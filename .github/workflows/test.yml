name: Test

on:
  pull_request:
    branches:
      - master
  release:
    types: [released, prereleased]
  push:
    tags:
      - '*'
    branches:
      - '*'
  create:
  delete:

jobs:
  cancel:
    name: Cancel any previous workflows
    runs-on: ubuntu-20.04
    steps:
      # https://github.com/styfle/cancel-workflow-action
      - uses: styfle/cancel-workflow-action@a40b8845c0683271d9f53dfcb887a7e181d3918b
        with:
          access_token: ${{ github.token }}

  lint:
    name: Lint
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579
        with:
          ref: 'master'

  notify:
    name: Notify
    runs-on: ubuntu-20.04
    needs: [lint]
    if: always()
    steps:
      - uses: actions/checkout@ec3a7ce113134d7a93b817d10a8272cb61118579
        with:
          ref: 'master'
      - name: Test Output
        uses: ./ # Uses an action in the root directory
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
